const PROFILES = {
  sid: {
    cover: "images/bg.png",
    avatar: "images/sid.png",
    name: "Sid",
    role: "TOPFRAGTORSKEN / Kellerth med en offensiv och snabb spelstil, bra aim och relativt  bra gamesense.",
    about: "Han spelar oftast Fortnite men ibland Valorant. Jag b√∂rjade med esporten genom kompisar, n√§r jag var hemma hos dom och spelade s√• blev jag indragen i det och ville spela mer f√∂r det var roligt. Det f√∂rsta spelet jag blev bra p√• var Fortnite f√∂r det var ett av de f√∂rsta spelen jag spelade p√• riktigt. Jag spelar ungef√§r 4-8 timmar per dag beroende om man g√∂r n√•got annat under dagen eller inte. Mina f√∂r√§ldrar tycker att det √§r roligt att jag spelar f√∂r att jag tj√§nar pengar p√• det men de √§r ocks√• glada f√∂r att jag g√∂r andra saker √§n att spela. Det k√§nns bra n√§r man vinner en match men n√§r man f√∂rlorar en match man egentligen skulle vinna s√• blir man frustrerad och man t√§nker p√• vad man skulle kunnat g√∂ra annorlunda s√• man skulle kunna vunnit.",
    exp: [
      {
        year: "2025",
        title: "Korvgubbarna ‚Äî ???",
        desc: "???",
      },
      {
        year: "2025",
        title: "LAN Mix",
        desc: "???",
      },
    ],
    phone: "(+46) 700-000000",
    email: "sid@example.com",
    address: "Stockholm, Sweden",
  },
  eliot: {
    cover: "images/bg.png",
    avatar: "images/Eliot.png",
    name: "Eliot",
    role: "Kxnjipxlr / Enstj√§rna med en relativt defensiv spelstil och spelar mest Valorant.",
    about: "Jag b√∂rjade med esport f√∂r ungef√§r 1 ¬Ω √•r sedan, det var d√• jag fick min f√∂rsta highspec dator. Samma dag som jag fick datorn installerade jag Valorant. Nu har jag k√∂rt spelet varje dag i 5-6 timmar sedan dag 1. Jag spenderar ca 2 timmar p√• riktig tr√§ning och sedan 4 timmar till p√• att k√∂ra vanliga matcher. Mina f√∂r√§ldrar har aldrig riktigt varit v√§ldigt st√∂djande n√§r det g√§ller min esports karri√§r men de respekterar mina ambitioner. Det som fick mig att fastna med esporten var k√§nslan av att vinna. K√§nslan av att ha gjort n√•got bra, n√•got r√§tt. N√§r det kommer till matcher som man f√∂rlorar kan det vara lite surt, speciellt om man har gjort sitt b√§sta men ingen annan p√• laget presterar bra s√• kan det vara extremt frustrerande.",
    exp: [
      {
        year: "2025",
        title: "IGL ‚Äî Mix Teams",
        desc: "Mid-round calling & anti-tilt leadership.",
      },
      {
        year: "2025",
        title: "Korvgubbarna ‚Äî Initiator",
        desc: "Lineups + info plays; enables duelists.",
      },
    ],
    phone: "(+46) 731-111111",
    email: "eliot@example.com",
    address: "Stockholm, Sweden",
  },
  colin: {
    cover: "images/bg.png",
    avatar: "images/Colin.png",
    name: "Colin",
    role: "Ayato / Entry fragger med en aggressiv spelstil.",
    about: "spelar mest valorant men ibland andra spel. Jag b√∂rjade med det genom att min pappa k√∂pte en xbox 360 som jag fick spela p√• ofta vilket sparkade ig√•ng mitt intresse. Det f√∂rsta spelet jag blev bra p√• var fortnite f√∂r flera √•r sen. Jag tr√§nar runt 5-6 timmar per dag. Mina f√∂r√§ldrar var emot det i b√∂rjan men har med tiden blivit mer och mer vana vid det. K√§nslan att vinna en match ger en sorts bel√∂ningsk√§nsla vilket √§r likt n√§r man m√§rker att man typ f√•tt ett A p√• ett prov, k√§nslan n√§r man f√∂rlorar n√•got man borde vunnit √§r raka motsatsen och k√§nns inte alls kuligt. ",
    exp: [
      {
        year: "2000",
        title: "IGL ‚Äî Mix Teams",
        desc: "???",
      },
      {
        year: "2025",
        title: "Korvgubbarna ‚Äî Defense",
        desc: "???",
      },
    ],
    phone: "(+46) 732-4444444",
    email: "Colin@example.com",
    address: "Stockholm, Sweden",
  },
  damjan: {
    cover: "images/bg.png",
    avatar: "images/Damjan.png",
    name: "Damjan",
    role: "Machinegunkelly / Flex med en allsidig spelstil.",
    about: "Jag b√∂rjade med att jag fick min f√∂rsta konsol f√∂r flera √•r sen och d√§r b√∂rjade mitt intresse i e-sport. Det f√∂rsta spelet jag har spelat var Fortnite, jag var inte s√• bra men sen bytte jag spel till Rocket League och jag visste att jag kunde bli b√§ttre och satsade p√• det. Jag tr√§nar ungef√§r 3-4 timmar. Mina f√∂r√§ldrar tycker inte s√• mycket n√§r jag spelar f√∂r mycket men de vet sj√§lva att jag sitter och g√∂r ingenting. N√§r man vinner en match d√• k√§nns det bra, men n√§r man f√∂rlorar en match fast man vet att jag skulle vinna k√§nns jag att jag vill ta s√∂nder n√•gonting.",
    exp: [
      {
        year: "2021",
        title: "IGL ‚Äî Mix Teams",
        desc: "???",
      },
      {
        year: "2025",
        title: "Korvgubbarna ‚Äî Team player",
        desc: "???",
      },
    ],
    phone: "(+46) 731-111111",
    email: "Damjan@example.com",
    address: "Stockholm, Sweden",
  },
  emile: {
    cover: "images/bg.png",
    avatar: "images/Emile.png",
    name: "Emile",
    role: "ÔæíolivenÔæí / Flex med en allsidig spelstil.",
    about: "b√∂rjade med dataspel redan vid ung √•lder d√• livet saknade hobbys utan t√§vlingsk√§nsla. Det gick fr√•n mobilspel p√• en gammal Huawei  till 16 timmar LAN och t√§vlande runt om i v√§rlden, fr√•n att vinna fiskdamm p√• kalas till att vinna priser v√§rda flera tusen kronor. Det finns inget ord som beskriver slack och f√∂rluster till mig, utan allting handlar om att bara k√§mpa och spela f√∂r vinsten. Esport blev en stor grej till mig eftersom att jag tidigt l√§rde mig att bli en vinnarskalle. En av de f√∂rsta spelen som lockade mig var Fortnite i mina tidiga √•r. Jag tr√§nar inte lika ofta l√§ngre eftersom jag har √∂verg√•tt till andra viktiga saker i livet, men passionen finns fortfarande kvar. Mina f√∂r√§ldrar har aldrig haft n√•got emot mitt spelande ‚Äì de tyckte bara att jag borde pr√∂va n√•gon annan hobby, vilket jag ocks√• gjorde n√§r jag blev √§ldre. F√∂r mig finns det inget som heter f√∂rlust, bara l√§xor. Varje g√•ng n√•got inte g√•r som planerat tar jag det som en chans att utvecklas, inte som ett nederlag. Det handlar alltid om att vinna ‚Äì men √§nnu mer om att v√§xa",
    exp: [
      {
        year: "2020",
        title: "IGL ‚Äî Mix Teams",
        desc: "???",
      },
      {
        year: "2025",
        title: "Korvgubbarna ‚Äî Dps",
        desc: "???",
      },
    ],
    phone: "(+46) 731-111111",
    email: "Emile@example.com",
    address: "Stockholm, Sweden",
  },
  djamil: {
    cover: "images/bg.png",
    avatar: "images/Djamil.png",
    name: "Djamil",
    role: "Vablu / Pusher med en aggressiv spelstil.",
    about: "Jag b√∂rjade spela spel n√§r Fortnite sl√§pptes. Till en b√∂rjan k√∂rde jag och min storebror p√• v√•r PS4 men efter ett √•r ungef√§r s√• k√∂pte v√•r pappa en gaming dator och den las i mitt rum. S√• efter det tr√§ffade jag nya v√§nner och spelade varje dag och tillslut b√∂rjade jag spela i turneringar och t√§vlade. S√• simpelt sagt s√• var mitt f√∂rsta spel jag blev v√§ldigt bra p√• var Fortnite. Mina f√∂r√§ldrar tyckte inte att det var negativt att jag spelade s√• mycket, s√• l√§nge inte det f√∂rhindrade mig att plugga, g√• p√• tr√§ningar och match osv. Eftersom Fortnite inte alltid var s√• j√§tteroligt s√• k√∂rde jag √§ven Valorant, GTA5, NBA 2K och massa andra spel. Men till slut s√• tr√∂ttnade jag p√• det och jag spelar inte s√• j√§ttemycket l√§ngre. Min spelstil varierar ganska mycket i olika spel, men i Valorant s√• har jag en v√§ldigt aggressiv mentalitet vilket kan gynna laget mycket men √§ven tv√§rtom. ",
    exp: [
      {
        year: "2020",
        title: "IGL ‚Äî Mix Teams",
        desc: "???",
      },
      {
        year: "2025",
        title: "Korvgubbarna ‚Äî Pusher",
        desc: "???",
      },
    ],
    phone: "(+46) 731-111111",
    email: "Djamil@example.com",
    address: "Stockholm, Sweden",
  },
};
function buildPcHTML(p) {
  const exp = p.exp
    .map(
      (e) => `
    <div class="pc-item" data-year="${e.year}">
      <div class="pc-item-title">${e.title}</div>
      <div class="pc-item-desc">${e.desc}</div>
    </div>`
    )
    .join("");

  return `
<article class="pc-card" data-state="#about">
  <header class="pc-header">
    <div class="pc-cover" style="background-image:url('${p.cover}')"></div>
    <img class="pc-avatar" src="${p.avatar}" alt="${p.name}">
    <div class="pc-title">
      <div class="pc-name">${p.name}</div>
      <div class="pc-role">${p.role}</div>
    </div>
  </header>

  <nav class="pc-tabs" aria-label="Profile sections">
    <button class="pc-tab is-active" data-target="#pc-about">About</button>
    <button class="pc-tab" data-target="#pc-exp">Experience</button>
    <button class="pc-tab" data-target="#pc-contact">Contact</button>
  </nav>

  <section class="pc-sections">
    <div class="pc-section is-active" id="pc-about">
      <p class="pc-desc">${p.about}</p>
    </div>

    <div class="pc-section" id="pc-exp">
      <div class="pc-timeline">${exp}</div>
    </div>

    <div class="pc-section" id="pc-contact">
      <div class="pc-contact-list">
        <div class="pc-contact">üìç ${p.address}</div>
        <a class="pc-contact" href="tel:${p.phone.replace(/[^\d+]/g, "")}">‚òé ${p.phone
    }</a>
        <a class="pc-contact" href="mailto:${p.email}">‚úâ ${p.email}</a>
      </div>
    </div>
  </section>
</article>`;
}

(function addPcStyles() {
  const css = `
.drawer-panel{background:#121216;color:#e9ecf1}
.pc-card{max-width:680px;margin:0 auto;background:#111115;border:1px solid rgba(255,255,255,.08);border-radius:16px;overflow:hidden;box-shadow:0 18px 48px rgba(0,0,0,.45)}
.pc-header{position:relative;height:200px}
.pc-cover{position:absolute;inset:0;background-size:cover;background-position:center;filter:blur(18px) saturate(1.1);transform:scale(1.12);opacity:.9}
.pc-avatar{position:absolute;right:24px;bottom:16px;width:150px;object-fit:contain;filter:drop-shadow(0 12px 24px rgba(0,0,0,.5))}
.pc-title{position:absolute;left:20px;bottom:20px}
.pc-name{font-weight:800;font-size:22px}
.pc-role{font-size:12px;opacity:.85}
.pc-tabs{display:flex;gap:8px;padding:10px;background:#0f0f12;border-top:1px solid rgba(255,255,255,.06)}
.pc-tab{flex:1;background:#191a22;border:1px solid rgba(255,255,255,.08);color:#cfd6e6;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700}
.pc-tab.is-active{background:linear-gradient(180deg,#26283a,#191a22);border-color:#7f8cff;color:#fff;box-shadow:0 0 0 1px #7f8cff inset}
.pc-sections{padding:16px}
.pc-section{display:none;animation:pcfade .3s both}
.pc-section.is-active{display:block}
@keyframes pcfade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
.pc-timeline{position:relative;margin-top:8px}
.pc-timeline::before{content:"";position:absolute;left:18px;top:0;bottom:0;width:2px;background:linear-gradient(#7f8cff,transparent)}
.pc-item{position:relative;padding-left:48px;margin:14px 0}
.pc-item::before{content:"";position:absolute;left:12px;top:.35em;width:12px;height:12px;border-radius:50%;background:#7f8cff;box-shadow:0 0 0 3px rgba(127,140,255,.25)}
.pc-item-title{font-weight:700}
.pc-item-desc{color:#aab3c7;font-size:13px}
.pc-contact-list{display:grid;gap:10px;margin-top:8px}
.pc-contact{display:flex;gap:10px;align-items:center;background:#171822;border:1px solid rgba(255,255,255,.06);padding:10px 12px;border-radius:10px;color:#dfe6ff;text-decoration:none}
  `;
  const tag = document.createElement("style");
  tag.textContent = css;
  document.head.appendChild(tag);
})();

const drawer = document.getElementById("profile-drawer");
const content = drawer.querySelector(".drawer-content");
let lastFocused = null;
const focusSel =
  'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';

function initPcTabs(scope) {
  const tabs = scope.querySelectorAll(".pc-tab");
  const sections = scope.querySelectorAll(".pc-section");
  tabs.forEach((tab) => {
    tab.addEventListener("click", () => {
      const target = scope.querySelector(tab.dataset.target);
      if (!target) return;
      tabs.forEach((t) => t.classList.remove("is-active"));
      sections.forEach((s) => s.classList.remove("is-active"));
      tab.classList.add("is-active");
      target.classList.add("is-active");
    });
  });
}

function openDrawer(key) {
  const p = PROFILES[key];
  if (!p) {
    console.error(`Profile not found for key: ${key}`);
    return;
  }
  console.log(`Opening drawer for: ${key}`, p);
  content.innerHTML = buildPcHTML(p);
  drawer.setAttribute("aria-hidden", "false");
  initPcTabs(content);
  const f = content.querySelectorAll(focusSel);
  if (f.length) f[0].focus();
}
function closeDrawer() {
  drawer.setAttribute("aria-hidden", "true");
  content.innerHTML = "";
  if (lastFocused) lastFocused.focus();
}

document.addEventListener("click", (e) => {
  const cardEl = e.target.closest(".cards .card[data-player]");
  if (cardEl) {
    e.preventDefault();
    console.log(`Card clicked: ${cardEl.getAttribute("data-player")}`);
    lastFocused = cardEl;
    openDrawer(cardEl.getAttribute("data-player"));
  }
  if (e.target.matches("[data-close]")) {
    e.preventDefault();
    console.log("Close button clicked");
    closeDrawer();
  }
});

drawer.addEventListener("click", (e) => {
  if (e.target.classList.contains("drawer-backdrop")) closeDrawer();
});
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && drawer.getAttribute("aria-hidden") === "false")
    closeDrawer();
});


const channel = "lbsnorraesport_";
const parentDomains = ["localhost", "korvgubbarna.se", "www.korvgubbarna.se"];

const offlineNote = document.getElementById("offline-note");
const statusBadge = document.getElementById("statusBadge");
const viewerChip = document.getElementById("viewerChip");

offlineNote.hidden = false;
statusBadge.textContent = "OFFLINE";
statusBadge.classList.remove("is-live");
viewerChip.hidden = true;

const embed = new Twitch.Embed("twitch-embed", {
  width: "100%",
  height: "100%",
  channel,
  layout: "video",
  autoplay: false,
  parent: parentDomains
});

embed.addEventListener(Twitch.Embed.ONLINE, () => {
  offlineNote.hidden = true;
  statusBadge.textContent = "LIVE";
  statusBadge.classList.add("is-live");
  viewerChip.hidden = false;
});

embed.addEventListener(Twitch.Embed.OFFLINE, () => {
  offlineNote.hidden = false;
  statusBadge.textContent = "OFFLINE";
  statusBadge.classList.remove("is-live");
  viewerChip.hidden = true;
});


(function () {
  const m = document.getElementById('s-matches');
  const w = document.getElementById('s-wins');
  const wr = document.getElementById('s-winrate');
  if (m && w && wr) {
    const mv = parseInt(m.textContent, 10) || 0;
    const wv = parseInt(w.textContent, 10) || 0;
    if (mv > 0) wr.textContent = (100 * wv / mv).toFixed(1) + '%';
  }
})();

